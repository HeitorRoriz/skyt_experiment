#!/usr/bin/env python3
"""
Compare actual code patterns generated by each model vs canon.
"""

import json
import glob

def main():
    print("="*80)
    print("MODEL PATTERN COMPARISON")
    print("="*80)
    
    # Load canon
    with open('outputs/canon/is_prime_strict_canon.json', 'r', encoding='utf-8') as f:
        canon_data = json.load(f)
    
    canon_code = canon_data.get('canonical_code', '')
    print("\n## CANON CODE:")
    print(canon_code)
    
    # Get latest experiments
    files = sorted(glob.glob('outputs/is_prime_strict_temp*.json'))[-15:]
    
    by_model = {
        'gpt-4o-mini': [],
        'gpt-4o': [],
        'claude-sonnet-4-5-20250929': []
    }
    
    for filepath in files:
        try:
            with open(filepath, 'r', encoding='utf-8') as f:
                data = json.load(f)
            
            model = data.get('model', 'unknown')
            if model in by_model:
                llm_outputs = data.get('llm_outputs', [])
                if llm_outputs:
                    by_model[model].append(llm_outputs[0])  # First output
        except:
            pass
    
    for model, codes in by_model.items():
        if not codes:
            continue
        
        print(f"\n{'='*80}")
        print(f"{model.upper()}")
        print(f"{'='*80}")
        
        # Show first sample
        sample = codes[0]
        print("\n## Sample Output:")
        print(sample)
        
        # Analyze patterns
        print("\n## Pattern Analysis:")
        print(f"  Uses 'result' flag: {'result =' in sample}")
        print(f"  Uses early return: {'return False' in sample and 'return True' in sample}")
        print(f"  Has 'else' block: {'else:' in sample}")
        print(f"  Uses 'limit' variable: {'limit =' in sample}")
        print(f"  Loop range: {'range(2, int(n**0.5) + 1)' in sample}")
        
        # Check if matches canon exactly
        matches_canon = sample.strip() == canon_code.strip()
        print(f"\n  âœ… Matches canon exactly: {matches_canon}")
        
        if not matches_canon:
            print(f"\n  Key differences from canon:")
            if 'result =' in sample and 'result =' not in canon_code:
                print("    - Uses 'result' flag (canon uses direct returns)")
            if 'else:' in sample and 'else:' not in canon_code:
                print("    - Has 'else' block (canon doesn't)")
            if 'limit =' in sample and 'limit =' not in canon_code:
                print("    - Uses 'limit' variable (canon uses inline)")
            if 'n < 2' in sample and 'n <= 1' in canon_code:
                print("    - Uses 'n < 2' (canon uses 'n <= 1')")

if __name__ == "__main__":
    main()
